@model Model.Users

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}

@Styles.Render("~/Content/Login.css")
@Scripts.Render("~/Scripts/Register.js")
@Scripts.Render("~/Scripts/jquery-3.3.1.js")
@Scripts.Render("~/Scripts/jquery.validate.js")

<script>
    $.getJSON("/Register/CheckUser/?username=" + username, function (data) {
            if (data) {
                //用户名存在
            }
        });

    $(function () {

        // 为看不清楚绑定事件  
        $("#see").click(function () {
            $("#vimg").attr("src", "@Url.Content("/YZM/GetYZM?")" + Math.random());
            });

        // 为验证码绑定click与mouseover  
        $("#vimg").mouseover(function () {
            $(this).css("cursor", "pointer");
            }).click(function () {
            $("#see").trigger("click");
            });
        });

        function reloadcode() {
            var verify = document.getElementById('validimg');
            verify.setAttribute('src', '@Url.Content("/YZM/GetYZM?")' + Math.random());
        }

    $(function () {
        $("btnlogin").click(function () {
                var username = $("#phonum").val();
                var userpassword = $("#txtpassword").val();
                var usercode = $("#txtverifcode").val();


                if (username == "") {
                    new TipBox({ type: 'tip', str: '请输入你的邮箱', clickDomCancel: true, setTime: 10000500, hasBtn: true });

                }
                else if (userpassword == "") {
                    new TipBox({ type: 'tip', str: '请输入你的密码', clickDomCancel: true, setTime: 10000500, hasBtn: true });
                }
                else if (usercode == "") {
                    new TipBox({ type: 'tip', str: '请输入你的验证码', clickDomCancel: true, setTime: 10000500, hasBtn: true });
                }

                else {
                $.ajax({
                        type: 'POST',
                    url: '/Register/Login',
                    params: { username: username, userpassword: userpassword, usercode: usercode },
                    callback: function (msg) {
                            if (msg == "success") {
                                new TipBox({ type: 'success', str: '登陆成功', hasBtn: true });
                            $("#phonum").val("");
                            $("#txtpassword").val("");
                            $("#txtverifcode").val("");
                            $("#phonum").focus();
                                location.href = "/Home/Test";
                            }
                            else if (msg == "failed") {
                                new TipBox({ type: 'error', str: '密码或者账户出错!', hasBtn: true });
                            $("#phonum").val("");
                            $("#txtpassword").val("");
                            $("#txtverifcode").val("");
                            $("#phonum").focus();
                            }
                        }
                    });
                }
            });

        $(document).keypress(function (e) {
                // 回车键事件
                if (e.which == 13) {
                $("#btnlogin").click();
                }
            });
        })

    $(function () {
            // 表单验证  
            formValidate();
        });

        var formValidate = function () {
        //// 添加自定义校验（邮政编码验证）  
        //jQuery.validator.addMethod("isZipCode", function (value, element) {
        //    var zipCode = /^[0-9]{6}$/;
        //    return this.optional(element) || (zipCode.test(value));
        //}, "请正确填写您的邮政编码");

        $("#addForm").validate({  // #JQForm是form表单的ID  
                rules: {
                    phonum: {  // 要验证的表单的id  
                    required: true, // 是否是必填项  
                    minlength: 2,  // 最小长度  
                    //remote: "/JQValidate/ValidateName"// 返回 true 就会出现错误信息  
                },
                txtpassword: {
                        required: true,
                    minlength: 2,
                    //range: [18, 30]
                },
                txtverifcode: {
                        required: true,
                    //isZipCode: true,
                },
            },
            messages: {// 如果没有给属性错误提示，就会用默认提示  
                    phonum: {
                    required: "请输入邮箱",  // 如果提交的时候没有填写提示的文字  
                    minlength: "邮箱的长度不能小于2位", // 如果输入的长度小于2提示的文字  
                    remote: "用户名重复"
                    },
                txtpassword: {
                        required: "密码不能为空",
                    //range: "年龄范围是18~30"
                },
                txtverifcode: {
                        required: "验证码不能为空",
                },
            },

            errorPlacement: function (error, element) { // 自定义错误信息放置的位置  
                    error.appendTo(element.next("errorMsg"));
                },
        })
    };
</script>
<style>
    .content{
            margin:30px 0;
        }
.login{
            margin:30px;
            height:300px;
        }

</style>
<div class="content">
    <ul id="myTab" class="nav nav-tabs">
        <li class="active">
            <a href="#home" data-toggle="tab">
                登录
            </a>
        </li>
        <li><a href="#ios" data-toggle="tab">注册</a></li>

    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="home">
            
            <div class="login">
                @using (Html.BeginForm("Login", "Register", FormMethod.Post, new { @class = "form-horizontal", role = "form",id= "addForm" }))
                {
                    @Html.AntiForgeryToken()
                    @*<form class="form-horizontal" role="form">*@
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">邮箱号</label>
                        <div class="col-sm-6">
                            @Html.TextBoxFor(model => model.User_email, new { @class = "form-control", type = "text", id = "phonum", style = "width: 300px;" })
                            @*<input id="phonum" type="text" class="form-control" style="width: 300px;">*@
                            <span class="errorMsg"></span> 
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputPassword3" class="col-sm-2 control-label">密码</label>
                        <div class="col-sm-6">
                            @Html.TextBoxFor(model => model.User_password, new { @class = "form-control", placeholder = "Password", type = "password", id = "txtpassword", style = "width: 300px;" })
                            @*<input type="password" style="width: 300px;" class="form-control" id="" placeholder="Password">*@
                            <span class="errorMsg"></span> 
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">验证码</label>
                        <div class="col-sm-6">
                            <div style="float: left;">
                                <input style="width: 200px;" class="form-control" id="codename">
                                @*<span id="codenameTip">*@

                            </div>
                            <div style="float: left;">
                                <span id="txtverifcode" class="verifcode"><img id="validimg" src="@Url.Action("GetYZM", "YZM")?t=@DateTime.Now.Ticks" alt="看不清，点击换一张" /></span>
                            </div>
                            <span class="errorMsg"></span> 
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-6">
                            @*<button type="button" id="btnlogin" class="btn btn-primary">立即登录</button>*@
                            <input type="submit" id="btnlogin"  class="btn btn-info" value="立即登录"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-6">
                            <span class="errorMsg">错误信息放置的位置</span> 
                        </div>
                    </div>

                }

            </div>

        </div>
        <div class="tab-pane fade" id="ios">
            <div class="login">
                @using (Html.BeginForm("Register", "Register", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                {
                    @*<form class="form-horizontal" role="form">*@
                    <div class="form-group">
                        <label class="col-sm-2 control-label">用户名</label>
                        <div class="col-sm-6">
                            @Html.TextBoxFor(model => model.User_name, new { @class = "form-control", id = "username", style = "width: 300px;" })
                            @*<input style="width: 300px;" class="form-control" id="username">*@
                            <span id="codenameTip"></span>
                        </div>
                    </div>
                        <div class="form-group">
                            <label for="inputPassword3" class="col-sm-2 control-label">密码</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(model => model.User_password, new { @class = "form-control", placeholder = "Password", type = "password", id = "", style = "width: 300px;" })
                                @*<input type="password" style="width: 300px;" class="form-control" id="" placeholder="Password">*@
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputPassword3" class="col-sm-2 control-label">确认密码</label>
                            <div class="col-sm-6">
                                @*@Html.TextBoxFor(model => model.ConfirmPassword, new { @class = "form-control", placeholder = "ConfirmPassword", type = "password", id = "", style = "width: 300px;" })*@
                                <input type="password" style="width: 300px;" class="form-control" id="" placeholder="Password">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3" class="col-sm-2 control-label">邮箱号</label>
                            <div class="col-sm-6">
                                <div style="float: left;">
                                    @Html.TextBoxFor(model => model.User_email, new { @class = "form-control", type = "text", id = "phonum", style = "width: 300px;" })
                                    @*<input id="phonum" type="text" class="form-control" style="width: 300px;">*@
                                </div>
                                <div style="float: left;">
                                    <input class="btn btn-info" type="button" id="getcode" value="点击获取邮箱验证码" />
                                    <span id="telephonenameTip"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">验证码</label>
                            <div class="col-sm-6">
                                <input style="width: 300px;" class="form-control" id="codename">
                                <span id="codenameTip"></span>
                            </div>
                        </div>



                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-6">
                                @*<button type="button" id="submit" class="btn btn-primary">立即注册</button>*@
                                <input type="submit" class="btn btn-info" value="立即注册" />
                            </div>
                        </div>
                }


            </div>
            </div>
        </div>
    </div>

